<#include "/admin/util/editor/editor.html" />
<#include "/admin/plugins/ticketing/commons.html" />

<#--
-- Get the base url an family pic is authorized to have
-- @param entry the entry
-- @return the base url
-->
<#function getBaseUrl entry>
	<#assign fieldFileBaseUrl = getFieldValue( entry, "base_url" )>
	<#if fieldFileBaseUrl?? && fieldFileBaseUrl != "">
		<#return fieldFileBaseUrl>
	</#if>
	<#return "">
</#function>

<div class="row">
	<div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
		<fieldset>
			<form class="form-horizontal" action="jsp/admin/plugins/ticketing/admin/ManageTicketInputEntry.jsp" method="post" name="" id=""  >
                <legend>#i18n{ticketing.modifyEntry.titleInput} '${entry.title}'</legend>
				<input name="id_entry" value="${entry.idEntry}" type="hidden" />
				<input name="action" value="doModifyEntry" type="hidden" />
				<div class="form-group">
					<label class="col-xs-12 col-sm-12 col-md-3 col-lg-3 control-label" for="title">#i18n{ticketing.createEntry.labelTitle} * </label>
					<div class="col-xs-12 col-sm-12 col-md-9 col-lg-9">
						<input type="text" name="title" id="title" value="${entry.title}"  maxlength="255" class="form-control">
						<span class="help-block">#i18n{ticketing.createEntry.labelTitleComment}</span>
					</div>
				</div>
				<div class="form-group">
					<label class="col-xs-12 col-sm-12 col-md-3 col-lg-3 control-label" for="title">#i18n{ticketing.createEntry.labelCode} * : </label>
	 				<div class="col-xs-12 col-sm-12 col-md-9 col-lg-9">
							<input type="text" name="entry_code" id="entry_code" value="${entry.code!}" maxlength="20" class="form-control">
							<span class="help-block">#i18n{ticketing.createEntry.labelCodeComment}</span>
					</div>
				</div>
				<div class="form-group">
					<label class="col-xs-12 col-sm-12 col-md-3 col-lg-3 control-label" for="help_message">#i18n{ticketing.createEntry.labelHelpMessage} </label>
					<div class="col-xs-12 col-sm-12 col-md-9 col-lg-9">
						<textarea name="help_message" id="help_message" rows="2" class="form-control">${entry.helpMessage}</textarea>
						<span class="help-block">#i18n{ticketing.createEntry.labelHelpMessageComment}</span>
					</div>
				</div>
				<div class="form-group">
					<label class="col-xs-12 col-sm-12 col-md-3 col-lg-3 control-label" for="comment"> #i18n{ticketing.createEntry.labelComment} </label>
					<div class="col-xs-12 col-sm-12 col-md-9 col-lg-9">
						<textarea name="comment" rows="2" class="form-control">${entry.comment}</textarea>
					</div>
				</div>
				<div class="form-group">
					<label class="col-xs-12 col-sm-12 col-md-3 col-lg-3 control-label">#i18n{ticketing.createEntry.labelType} :</label>
					<div class="col-xs-12 col-sm-12 col-md-9 col-lg-9">
						${entry.entryType.title}
					</div>
				</div>
				<div class="form-group">
					<label class="col-xs-12 col-sm-12 col-md-3 col-lg-3 control-label" for="value">#i18n{ticketing.createEntry.labelValueDefault} :</label>
					<#list entry.fields as field>
						<#if field.code?exists && field.code==entry.code>
							<div class="col-xs-12 col-sm-12 col-md-9 col-lg-9">
								<input type="text" name="value" id="value" value="${field.value}" class="form-control">
							</div>
						</#if>
					</#list>
				</div>
				<div class="form-group">
					<label class="col-xs-12 col-sm-12 col-md-3 col-lg-3 control-label" for="">&nbsp;</label>
					<div class="col-xs-12 col-sm-12 col-md-9 col-lg-9">
						<div class="checkbox">
							<label for="mandatory">
								<input name="mandatory" value="1" type="checkbox" <#if entry.mandatory>checked="checked" </#if> />
								&nbsp;#i18n{ticketing.createEntry.labelMandatory}
							</label>
						</div>
					</div>
				</div>
				<div class="form-group">
					<label class="col-xs-12 col-sm-12 col-md-3 col-lg-3 control-label" for="errorMessage"> #i18n{ticketing.createEntry.labelMandatoryErrorMessage} : </label>
					<div class="col-xs-12 col-sm-12 col-md-9 col-lg-9">
						<textarea name="errorMessage" rows="2" class="form-control">${entry.errorMessage!}</textarea>
						<span class="help-block">#i18n{ticketing.createEntry.labelMandatoryErrorMessageHelp}</span>
					</div>
				</div>
				<div class="form-group">
				<label class="col-xs-12 col-sm-12 col-md-3 col-lg-3 control-label" for="width">#i18n{ticketing.createEntry.labelWidth} * : </label>
					<div class="col-xs-12 col-sm-12 col-md-9 col-lg-9">
						<#list entry.fields as field>
							<#if field.code?exists && field.code==entry.code>
								<input  type="text" name="width" id="width" value="${field.width}" class="form-control">
								<#assign id_field=field.idField> 
							</#if>
						</#list>
					</div>
				</div>
				<div class="form-group">
				<label class="col-xs-12 col-sm-12 col-md-3 col-lg-3 control-label" for="max_size_enter">#i18n{ticketing.createEntry.labelMaxSizeEnter} : </label>
					<div class="col-xs-12 col-sm-12 col-md-9 col-lg-9">
						<#list entry.fields as field>
							<#if field.code?exists && field.code==entry.code>
								<input type="text" name="max_size_enter" id="max_size_enter" size="5" value="${field.maxSizeEnter}" class="form-control">
							</#if>
						</#list>	
					</div>
				</div>	
				<div class="form-group">
					<label class="col-xs-12 col-sm-12 col-md-3 col-lg-3 control-label" for="">&nbsp; </label>
					<div class="col-xs-12 col-sm-12 col-md-9 col-lg-9">
						<div class="checkbox">
							<label for="confirm_field">
								<input name="confirm_field" id="confirm_field" value="1" type="checkbox" onchange="javascript:changeVisilityConfirmFieldTitle();" <#if entry.confirmField> 	checked="checked"</#if>/>
								#i18n{ticketing.createEntry.labelConfirmField}
							</label>
						</div>
					</div>
				</div>
				<div class="form-group">
					<label class="col-xs-12 col-sm-12 col-md-3 col-lg-3 control-label" for="confirm_field_title">#i18n{ticketing.createEntry.labelConfirmFieldTitle} *</label>
					 <div class="col-xs-12 col-sm-12 col-md-9 col-lg-9">
						<input type="text" name="confirm_field_title" id="confirm_field_title" value="${entry.confirmFieldTitle!}" maxlength="255" class="form-control">
					</div>
				</div>
				<div class="form-group">
					<label class="col-xs-12 col-sm-12 col-md-3 col-lg-3 control-label" for="max_files">#i18n{module.ticketing.ticketingfacilfamilles.createEntry.labelBaseUrl} :</label>
					<div class="col-xs-12 col-sm-12 col-md-9 col-lg-9">
						<input type="text" name="base_url" id="base_url" class="form-control" value="${getBaseUrl(entry)}" />
						<span class="help-block">#i18n{module.ticketing.ticketingfacilfamilles.createEntry.labelBaseUrlMessageHelp}</span>
					</div>
				</div>
				<div class="form-group">
					<label class="col-xs-12 col-sm-12 col-md-3 col-lg-3 control-label" for="css_class">#i18n{ticketing.createEntry.labelCSSClass} : </label>
					<div class="col-xs-12 col-sm-12 col-md-9 col-lg-9">
						<input type="text" name="css_class" value="${entry.CSSClass!}" maxlength="255" class="form-control">
						<span class="help-block">#i18n{ticketing.createEntry.labelCSSClassComment}</span>
					</div>
				</div>
				<div class="form-group">
					<div class="col-xs-12 col-sm-12 col-md-offset-3 col-lg-offset-3">
						<button class="btn btn-primary btn-sm" name="save" type="submit">
							<i class="glyphicon glyphicon-ok"></i>&nbsp;#i18n{ticketing.modifyEntry.buttonSave}
						</button>
						<button class="btn btn-primary btn-sm" name="apply" type="submit">
							<i class="glyphicon glyphicon-ok-circle"></i>&nbsp;#i18n{ticketing.modifyEntry.buttonApply}
						</button>
						<button class="btn btn-default btn-sm" type="submit" name="cancel" value="cancel" >
							<i class="glyphicon glyphicon-remove-circle"></i>&nbsp;#i18n{ticketing.createEntry.buttonCancel}
						</button>
					</div>
				</div>
			</form>
		</fieldset>
		<#if regular_expression_list?exists>
			<fieldset> 
				<legend>#i18n{ticketing.createEntry.manageRegularExpression.title}</legend>
				<div class="well">
					<form class="form-horizontal"  method="post"  action="jsp/admin/plugins/ticketing/admin/ManageTicketInputEntry.jsp">
						<input name="id_field" value="${id_field}" type="hidden" />
						<input name="action" value="doInsertRegularExpression" type="hidden" />
						<div class="form-group">
							<label class="col-xs-12 col-sm-12 col-md-3 col-lg-3 control-label" for="id_expression">#i18n{ticketing.createEntry.manageRegularExpression.labelInsert} :</label>
							<div class="col-xs-12 col-sm-12 col-md-9 col-lg-9">
								<@combo name="id_expression" items=regular_expression_list default_value=-1 />
								<button class="btn btn-primary btn-sm" type="submit" >#i18n{ticketing.createEntry.manageRegularExpression.buttonInsert}</button>
								<span class="help-block">#i18n{ticketing.createEntry.manageRegularExpression.labelInsertComment}</span>
							</div>
						</div>
					</form>
					<table class="table table-striped">
						<tr> 
							<th>#i18n{ticketing.createEntry.manageRegularExpression.rowTitle}</th>
							<th>#i18n{ticketing.createEntry.manageRegularExpression.rowInformationMessage}</th>
							<th>#i18n{ticketing.createEntry.manageRegularExpression.rowValidExemple}</th>
							<th>#i18n{ticketing.createEntry.manageField.rowActions}</th>
						</tr>
						<#list list as field>
							<#list field.regularExpressionList as expression>
								<tr>
									<td>${expression.title}</td>
									<td>${expression.informationMessage}</td>
									<td>${expression.validExemple}</td>
									<td>
										<a class="btn btn-danger btn-sm" href="jsp/admin/plugins/ticketing/admin/ManageTicketInputEntry.jsp?action=doRemoveRegularExpression&id_expression=${expression.idExpression}&id_field=${id_field}" title="#i18n{ticketing.createEntry.manageField.titleDelete}" >
											<i class="glyphicon glyphicon-trash"></i>
										</a>
									</td>
								</tr>
							</#list>
						</#list>
					</table>
				</div>
			</fieldset>
		</#if>
	</div>
</div>
<script type="text/javascript">
function changeVisilityConfirmFieldTitle(){
if(document.getElementById("confirm_field").checked){
		document.getElementById("confirm_field_title_p").style.display = 'block';
	} else {
		document.getElementById("confirm_field_title_p").style.display = 'none';
	}
} 
changeVisilityConfirmFieldTitle();
</script>
<@initEditor />